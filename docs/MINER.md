# Miner Guide

- [Miner Guide](#miner-guide)
  - [Introduction](#introduction)
  - [Installation](#installation)
    - [Prerequisites](#prerequisites)
      - [OS dependencies](#os-dependencies)
      - [Rust](#rust)
      - [PM2](#pm2)
    - [Clone the repository](#clone-the-repository)
    - [Install dependencies](#install-dependencies)
    - [Environment Variables](#environment-variables)
    - [Running](#running)
  - [Monitoring](#monitoring)
  - [Troubleshooting | Support](#troubleshooting--support)


## Introduction
The Miner is responsible for solving the challenges generated by the Validator. The Miner will receive the challenges from the Validator, solve them, and submit the solutions back to the Validator. The Miner will be rewarded based on the number of challenges solved and the quality of the solutions.

We provided a default (baseline) simple solution for the miner to start with. It uses LLM to generate the solution.
Feel free to develop and implement your own solution. Better solutions earn greater rewards over time.

## Installation

### Prerequisites

* Python 3.10 [see](#os-dependencies)
* Rust [see](#rust)
* PM2 [see](#pm2)
* OpenAI API key [see](#environment-variables)

#### OS dependencies
```bash
sudo apt-get update
sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt-get install -y python3.10 python3.10-venv curl gcc pkg-config make git npm
```

#### Rust
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
export PATH="/root/.cargo/bin:$PATH"
rustup update stable
```

#### PM2
Install [PM2](https://pm2.io/docs/runtime/guide/installation/):

```bash
npm install pm2 -g && pm2 update
```

Otherwise, you can try this:

```bash
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
apt install -y nodejs
npm install -g pm2
```

### Clone the repository
Clone the repository and navigate to the folder.
 
```bash
git clone https://github.com/gutenberg-team/fakenews-subnet.git && cd fakenews-subnet
```

### Install dependencies
Install the necessary dependencies:

```bash 
bash scripts/install_env.sh
```
This step included into miner [running](#running) script as well. You can use this step manually to ensure that all dependencies are installed and no errors occur.

### Environment Variables

First of all, create and configute `miner.env` file.
Provide all necessary environment variables as follows:

Bittensor Configuration:
* `NETUID` - Bittensor subnet ID.
* `SUBTENSOR_NETWORK` - Bittensor network name. Options: `finney`, `test`, `local`.
* `SUBTENSOR_CHAIN_ENDPOINT` - Bittensor chain endpoint.
* `AXON_PORT` - Bittensor axon port.

Wallet Configuration:
* `WALLET_NAME` - Coldkey name.
* `WALLET_HOTKEY` - Hotkey name.

API Keys:
* `OPENAI_API_KEY` - OpenAI API key. You should provide your own paid key with access to "gpt-4o-mini" model.

Blacklist Configuration:
* `BLACKLIST_FORCE_VALIDATOR_PERMIT` - Optional, default False. Force validator permit.
* `BLACKLIST_VALIDATOR_MIN_STAKE` - Optional, default Validator min stake.

Example (look at `miner.env.example` as well):
```bash
NETUID=60
SUBTENSOR_NETWORK=finney
SUBTENSOR_CHAIN_ENDPOINT=wss://entrypoint-finney.opentensor.ai:443
AXON_PORT=8091
WALLET_NAME=default
WALLET_HOTKEY=default
OPENAI_API_KEY=your_openai_api_key

BLACKLIST_FORCE_VALIDATOR_PERMIT=false
BLACKLIST_VALIDATOR_MIN_STAKE=1000
```

### Running

You can run your miner with `start_miner.sh`:

```bash
bash scripts/start_miner.sh 
```
The signal of successful start is the following message:
```
┌────┬───────────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name                  │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼───────────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ fakenews_miner        │ default     │ N/A     │ fork    │ 643793   │ 0s     │ 0    │ online    │ 0%       │ 5.8mb    │ root     │ disabled │
└────┴───────────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
```

## Monitoring

You can monitor your miner with PM2:

```bash
pm2 monit
```

or check the logs:

```bash
pm2 logs fakenews-miner
```

## Troubleshooting | Support

- **Logs**:
  - Please see the logs for more details using the following command.
  ```bash
  pm2 logs fakenews-miner
  ```
- **Common Issues**:
  - Missing environment variables.
  - Connectivity problems.
  - Incorrect wallet configuration | Small wallet balance.

- **Contact Support**:
- [Discord](https://discord.gg/MA5hwj2Q)
